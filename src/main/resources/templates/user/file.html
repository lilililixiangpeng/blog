<!DOCTYPE html>

<html lang="zh-Hans" xmlns:th="http://www.thymeleaf.org">
<head th:replace="user/Afragments :: userhead">
</head>
    <body>
        <div th:replace="user/Afragments :: header"></div>
        <div th:replace="user/Afragments :: sidebar"></div>
        <div th:replace="user/Afragments :: right-sidebar"></div>

        <!-- Start #content -->
        <div id="content">
            <!-- Start .content-wrapper -->
            <div class="content-wrapper">
                <div class="row">
                    <!-- Start .row -->
                    <!-- Start .page-header -->
                    <div class="col-lg-12 heading">
                        <h1 class="page-header"><i class="en-upload"></i> File manager</h1>
                        <!-- Start .bredcrumb -->
                        <ul id="crumb" class="breadcrumb">
                        </ul>
                        <!-- End .breadcrumb -->
                        <!-- Start .option-buttons -->
                        <div class="option-buttons">
                            <div class="btn-toolbar" role="toolbar">
                                <div class="btn-group">
                                    <a id="clear-localstorage" class="btn tip" title="Reset panels position">
                                        <i class="ec-refresh color-red s24"></i>
                                    </a>
                                </div>
                                <div class="btn-group dropdown">
                                    <a class="btn dropdown-toggle" data-toggle="dropdown" id="dropdownMenu1"><i class="br-grid s24"></i></a>
                                    <div class="dropdown-menu pull-right" role="menu" aria-labelledby="dropdownMenu1">
                                        <div class="option-dropdown">
                                            <div class="shortcut-button">
                                                <a href="#">
                                                    <i class="im-pie"></i>
                                                    <span>Earning Stats</span>
                                                </a>
                                            </div>
                                            <div class="shortcut-button">
                                                <a href="#">
                                                    <i class="ec-images color-dark"></i>
                                                    <span>Gallery</span>
                                                </a>
                                            </div>
                                            <div class="shortcut-button">
                                                <a href="#">
                                                    <i class="en-light-bulb color-orange"></i>
                                                    <span>Fresh ideas</span>
                                                </a>
                                            </div>
                                            <div class="shortcut-button">
                                                <a href="#">
                                                    <i class="ec-link color-blue"></i>
                                                    <span>Links</span>
                                                </a>
                                            </div>
                                            <div class="shortcut-button">
                                                <a href="#">
                                                    <i class="ec-support color-red"></i>
                                                    <span>Support</span>
                                                </a>
                                            </div>
                                            <div class="shortcut-button">
                                                <a href="#">
                                                    <i class="st-lock color-teal"></i>
                                                    <span>Lock area</span>
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="btn-group dropdown">
                                    <a class="btn dropdown-toggle" data-toggle="dropdown" id="dropdownMenu2"><i class="ec-pencil s24"></i></a> 
                                    <div class="dropdown-menu pull-right" role="menu" aria-labelledby="dropdownMenu2">
                                        <div class="option-dropdown">
                                            <div class="row">
                                                <p class="col-lg-12">Quick post</p>
                                                <form class="form-horizontal" role="form">
                                                    <div class="form-group">
                                                        <div class="col-lg-12">
                                                            <input type="text" class="form-control" placeholder="Enter title">
                                                        </div>
                                                    </div>
                                                    <!-- End .form-group  -->
                                                    <div class="form-group">
                                                        <div class="col-lg-12">
                                                            <textarea class="form-control wysiwyg" placeholder="Enter text"></textarea>
                                                        </div>
                                                    </div>
                                                    <!-- End .form-group  -->
                                                    <div class="form-group">
                                                        <div class="col-lg-12">
                                                            <input type="text" class="form-control tags1" placeholder="Enter tags">
                                                        </div>
                                                    </div>
                                                    <!-- End .form-group  -->
                                                    <div class="form-group">
                                                        <div class="col-lg-12">
                                                            <button class="btn btn-default btn-xs">Save Draft</button>
                                                            <button class="btn btn-success btn-xs pull-right">Publish</button>
                                                        </div>
                                                    </div>
                                                    <!-- End .form-group  -->
                                                </form>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="btn-group">
                                    <a class="btn dropdown-toggle" data-toggle="dropdown" id="dropdownMenu3"><i class="ec-help s24"></i></a>
                                    <div class="dropdown-menu pull-right" role="menu" aria-labelledby="dropdownMenu3">
                                        <div class="option-dropdown">
                                            <p>First time visitor ? <a href="#" id="app-tour" class="btn btn-success ml15">Take app tour</a> 
                                            </p>
                                            <hr>
                                            <p>Or check the <a href="#" class="btn btn-danger ml15">FAQ</a>
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- End .option-buttons -->
                    </div>
                    <!-- End .page-header -->
                </div>
                <!-- End .row -->
                <!-- Page start here ( usual with .row ) -->
                <div class="outlet">
                    <!-- Start .outlet -->
                    <div class="row">
                        <div class="col-md-12">
                            <blockquote>
                                <p style="font-size:16px">
                                    File Upload widget with multiple file selection, drag&amp;drop support, progress bars and preview images for jQuery.
                                    <br>Supports cross-domain, chunked and resumable file uploads and client-side image resizing.
                                    <br>Works with any server-side platform (PHP, Python, Ruby on Rails, Java, Node.js, Go etc.) that supports standard HTML form file uploads.
                                </p>
                            </blockquote>
                            <br>
                            <form id="fileupload" th:action="@{/upload/file}" method="POST" enctype="multipart/form-data" class="">
                                <!-- The fileupload-buttonbar contains buttons to add/delete files and start/cancel the upload -->
                                <div class="row fileupload-buttonbar">
                                    <div class="col-lg-7">
                                        <!-- The fileinput-button span is used to style the file input field as button -->
                                        <span class="btn btn-success fileinput-button">
                            <i class="en-plus3"></i>
                            <span>Add files...</span>
                                        <input type="file" name="files[]" >
                                        </span>
                                        <button type="submit" class="btn btn-primary start">
                                            <i class="en-upload"></i>
                                            <span>Start upload</span>
                                        </button>
                                        <button type="reset" class="btn btn-warning cancel">
                                            <i class="fa-ban-circle"></i>
                                            <span>Cancel upload</span>
                                        </button>
                                        <button type="button" class="btn btn-danger delete">
                                            <i class="en-trash"></i>
                                            <span>Delete</span>
                                        </button>
                                        <input type="checkbox" class="toggle">
                                        <!-- The global file processing state -->
                                        <span class="fileupload-process">
                                        </span>
                                    </div>
                                    <!-- The global progress information -->
                                    <div class="col-lg-5 fileupload-progress fade">
                                        <!-- The global progress bar -->
                                        <div class="progress progress-striped active" role="progressbar" aria-valuemin="0" aria-valuemax="100">
                                            <div class="progress-bar progress-bar-success" style="width:0%;">
                                            </div>
                                        </div>
                                        <!-- The extended global progress information -->
                                        <div class="progress-extended">
                                            &nbsp;
                                        </div>
                                    </div>
                                </div>
                                <!-- The table listing the files available for upload/download -->
                                <table role="presentation" class="table table-striped clearfix">
                                    <tbody class="files">
                                    </tbody>
                                </table>
                            </form>
                            <div class="panel panel-success">
                                <div class="panel-heading">
                                    <h3 class="panel-title">Demo Notes</h3>
                                </div>
                                <div class="panel-body">
                                    <ul>
                                        <li>
                                            The maximum file size for uploads in this demo is <strong>5 MB</strong> (default file size is unlimited).
                                        </li>
                                        <li>
                                            Only image files (<strong>JPG, GIF, PNG</strong>) are allowed in this demo (by default there is no file type restriction).
                                        </li>
                                        <li>
                                            Uploaded files will be deleted automatically after <strong>5 minutes</strong> (demo setting).
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- Page End here -->
                </div>
                <!-- End .outlet -->
                <!-- The blueimp Gallery widget -->
                <div id="blueimp-gallery" class="blueimp-gallery blueimp-gallery-controls" data-filter=":even">
                    <div class="slides">
                    </div>
                    <h3 class="title"></h3>
                    <a class="prev">
         ‹
    </a>
                    <a class="next">
         ›
    </a>
                    <a class="close white">
                    </a>
                    <a class="play-pause">
                    </a>
                    <ol class="indicator">
                    </ol>
                </div>

            </div>
            <!-- End .content-wrapper -->
            <div class="clearfix"></div>
        </div>
        <!-- End #content -->


        <<!-- Javascripts -->
        <!-- Load pace first -->
        <script th:src="@{/assets/plugins/core/pace/pace.min.js}"></script>
        <!-- Important javascript libs(put in all pages) -->
        <script th:src="@{/assets/js/jquery-1.8.3.min.js}"></script>
        <script>
            window.jQuery || document.write('<script th:src="@{/assets/js/libs/jquery-2.1.1.min.js}">\x3C/script>')
        </script>
        <script src="http://code.jquery.com/ui/1.10.4/jquery-ui.js"></script>
        <script>
            window.jQuery || document.write('<script th:src="@{/assets/js/libs/jquery-ui-1.10.4.min.js}">\x3C/script>')
        </script>
        <!--[if lt IE 9]>
        <script type="text/javascript" th:src="@{/assets/js/libs/excanvas.min.js}"></script>
        <script type="text/javascript" src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
        <script type="text/javascript" th:src="@{/assets/js/libs/respond.min.js}"></script>
        <![endif]-->
        <!-- Bootstrap plugins -->
        <script th:src="@{/assets/js/bootstrap/bootstrap.js}"></script>
        <!-- Core plugins ( not remove ever) -->
        <!-- Handle responsive view functions -->
        <script th:src="@{/assets/js/jRespond.min.js}"></script>
        <!-- Custom scroll for sidebars,tables and etc. -->
        <script th:src="@{/assets/plugins/core/slimscroll/jquery.slimscroll.min.js}"></script>
        <script th:src="@{/assets/plugins/core/slimscroll/jquery.slimscroll.horizontal.min.js}"></script>
        <!-- Resize text area in most pages -->
        <script th:src="@{/assets/plugins/forms/autosize/jquery.autosize.js}"></script>
        <!-- Proivde quick search for many widgets -->
        <script th:src="@{/assets/plugins/core/quicksearch/jquery.quicksearch.js}"></script>
        <!-- Bootbox confirm dialog for reset postion on panels -->
        <script th:src="@{/assets/plugins/ui/bootbox/bootbox.js}"></script>
        <!-- Other plugins ( load only nessesary plugins for every page) -->
        <script th:src="@{/assets/plugins/core/moment/moment.min.js}"></script>
        <script th:src="@{/assets/plugins/charts/sparklines/jquery.sparkline.js}"></script>
        <script th:src="@{/assets/plugins/charts/pie-chart/jquery.easy-pie-chart.js}"></script>
        <script th:src="@{/assets/plugins/forms/icheck/jquery.icheck.js}"></script>
        <script th:src="@{/assets/plugins/forms/tags/jquery.tagsinput.min.js}"></script>
        <script th:src="@{/assets/plugins/forms/tinymce/tinymce.min.js}"></script>
        <script th:src="@{/assets/plugins/misc/highlight/highlight.pack.js}"></script>
        <script th:src="@{/assets/plugins/misc/countTo/jquery.countTo.js}"></script>
        <script th:src="@{/assets/plugins/file/jquery.ui.widget.js}"></script>
        <script th:src="@{/assets/plugins/file/tmpl.min.js}"></script>
        <script th:src="@{/assets/plugins/file/load-image.min.js}"></script>
        <script th:src="@{/assets/plugins/file/canvas-to-blob.min.js}"></script>
        <script th:src="@{/assets/plugins/file/jquery.blueimp-gallery.min.js}"></script>
        <script th:src="@{/assets/plugins/file/jquery.iframe-transport.js}"></script>
        <script th:src="@{/assets/plugins/file/jquery.fileupload.js}"></script>
        <script th:src="@{/assets/plugins/file/jquery.fileupload-process.js}"></script>
        <script th:src="@{/assets/plugins/file/jquery.fileupload-image.js}"></script>
        <script th:src="@{/assets/plugins/file/jquery.fileupload-audio.js}"></script>
        <script th:src="@{/assets/plugins/file/jquery.fileupload-video.js}"></script>
        <script th:src="@{/assets/plugins/file/jquery.fileupload-validate.js}"></script>
        <script th:src="@{/assets/plugins/file/jquery.fileupload-ui.js}"></script>
        <script th:src="@{/assets/js/jquery.sprFlat.js}"></script>
        <script th:src="@{/assets/js/app.js}"></script>
        <script th:src="@{/assets/js/pages/file.js}"></script>

        <script th:src="@{/websocket/js/sockjs.min.js}"></script>
        <script th:src="@{/websocket/js/stomp.min.js}"></script>
        <script th:inline="javascript">
            var friendname;
            var username = [[${username}]];
            var socket = new SockJS('/ws');
            var stompClient = Stomp.over(socket);
            var rsinner1 = $('#right-sidebar>.sidebar-inner');
            stompClient.connect({}, onConnected);

            function onConnected() {
                // Subscribe to the Public Channel
                //可以绑定多个接收通道
                stompClient.subscribe('/user/queue/notifications', onMessageReceived);
                //stompClient.subscribe('/channel/public', onMessageReceived);
            }

            function sendchatMessage() {
                var chatMessage = {
                    sender: username,
                    content: $("#sendMsg").val(),
                    senderto: friendname
                };
                stompClient.send("/app/chat.onetoone", {}, JSON.stringify(chatMessage));
            }


            function onMessageReceived(payload) {
                var message = JSON.parse(payload.body);
                rsinner1.animate({ scrollTop: rsinner1[0].scrollHeight }, 1000);
                appendmessage(message);
            }

            function appendmessage (msg) {
                var username = msg.sender;
                $('.chat-box .chat-messages').append('<li class="chat-user"><p class="avatar"><img src="../getfriendimg?username='+ username +'"></p><p class="chat-name">'+msg.sender+' <span class="chat-time">'+ msg.time +'</span></p><span class="status online"><i class="en-dot"></i></span><p class="chat-txt">'+ msg.content +'</p></li>');
            }

            function getname(obj) {
                var test = obj.href;
                friendname = test.substr(27);
                $("#userfalg").text(friendname);
            }


            function getCurrentTime() {
                var date = new Date();//当前时间
                var month = zeroFill(date.getMonth() + 1);//月
                var day = zeroFill(date.getDate());//日
                var hour = zeroFill(date.getHours());//时
                var minute = zeroFill(date.getMinutes());//分
                var second = zeroFill(date.getSeconds());//秒

                //当前时间
                var curTime =  month + "-" + day
                    + " " + hour + ":" + minute + ":" + second;

                return curTime;
            }

            function zeroFill(i){
                if (i >= 0 && i <= 9) {
                    return "0" + i;
                } else {
                    return i;
                }
            }
        </script>
    </body>
</html>